{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/victor/Desktop/dev/cade-meu-bloco/components/leaflet-map.tsx"],"sourcesContent":["// components/leaflet-map.tsx\n\"use client\"\n\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\"\nimport L from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\nimport { useEffect, useImperativeHandle, forwardRef, useRef } from \"react\"\n\n// √çcone para blocos m√≥veis (laranja) e fixos (roxo) - sempre com √≠cone de m√∫sica\nconst createIcon = (isLive: boolean, isFixed: boolean) => {\n    const bgColor = !isLive\n        ? 'bg-zinc-600'\n        : isFixed\n            ? 'bg-violet-500'\n            : 'bg-orange-500'\n\n    const pingColor = !isLive\n        ? ''\n        : isFixed\n            ? 'bg-violet-500/30'\n            : 'bg-orange-500/30'\n\n    return L.divIcon({\n        className: \"custom-marker\",\n        html: `\n      <div class=\"relative flex items-center justify-center\">\n        ${isLive ? `<div class=\"absolute w-12 h-12 rounded-full ${pingColor} animate-ping\"></div>` : ''}\n        ${isLive ? `<div class=\"absolute w-12 h-12 rounded-full ${pingColor}\"></div>` : ''}\n        <div class=\"relative w-10 h-10 rounded-full ${bgColor} flex items-center justify-center shadow-lg border-2 border-zinc-900\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#1a1a1a\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M9 18V5l12-2v13\"/>\n            <circle cx=\"6\" cy=\"18\" r=\"3\"/>\n            <circle cx=\"18\" cy=\"16\" r=\"3\"/>\n          </svg>\n        </div>\n      </div>\n    `,\n        iconSize: [48, 48],\n        iconAnchor: [24, 24],\n    })\n}\n\nconst userIcon = L.divIcon({\n    className: \"custom-marker\",\n    html: `\n    <div class=\"relative flex items-center justify-center\">\n      <div class=\"absolute w-8 h-8 rounded-full bg-cyan-500/30 animate-ping\"></div>\n      <div class=\"relative w-6 h-6 rounded-full bg-cyan-500 border-2 border-zinc-900 flex items-center justify-center\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#1a1a1a\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <polygon points=\"3 11 22 2 13 21 11 13 3 11\"/>\n        </svg>\n      </div>\n    </div>\n  `,\n    iconSize: [32, 32],\n    iconAnchor: [16, 16],\n})\n\ninterface Stage {\n    id: string\n    name: string\n    genre: string\n    currentArtist: string\n    location: { lat: number; lng: number }\n    friendsCount: number\n    isLive: boolean\n    isFixed: boolean\n}\n\ninterface LeafletMapProps {\n    stages: Stage[]\n    userLocation: { lat: number; lng: number }\n    selectedStage: string | null\n    onSelectStage: (id: string | null) => void\n}\n\nexport interface LeafletMapRef {\n    centerOnUser: () => void\n}\n\nfunction MapController({\n                           selectedStage,\n                           stages,\n                           userLocation,\n                           mapRef\n                       }: {\n    selectedStage: string | null\n    stages: Stage[]\n    userLocation: { lat: number; lng: number }\n    mapRef: React.MutableRefObject<{ centerOnUser: () => void } | null>\n}) {\n    const map = useMap()\n\n    useEffect(() => {\n        if (selectedStage) {\n            const stage = stages.find(s => s.id === selectedStage)\n            if (stage) {\n                map.flyTo([stage.location.lat, stage.location.lng], 16, { duration: 0.5 })\n            }\n        }\n    }, [selectedStage, stages, map])\n\n    useEffect(() => {\n        mapRef.current = {\n            centerOnUser: () => {\n                map.flyTo([userLocation.lat, userLocation.lng], 16, { duration: 0.5 })\n            }\n        }\n    }, [map, userLocation, mapRef])\n\n    return null\n}\n\nexport const LeafletMap = forwardRef<LeafletMapRef, LeafletMapProps>(\n    ({ stages, userLocation, selectedStage, onSelectStage }, ref) => {\n        const mapRef = useRef<{ centerOnUser: () => void } | null>(null)\n\n        useImperativeHandle(ref, () => ({\n            centerOnUser: () => {\n                mapRef.current?.centerOnUser()\n            }\n        }))\n\n        return (\n            <MapContainer\n                center={[userLocation.lat, userLocation.lng]}\n                zoom={13}\n                className=\"w-full h-full\"\n                zoomControl={false}\n            >\n                <TileLayer\n                    attribution='&copy; <a href=\"https://carto.com/\">CARTO</a>'\n                    url=\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\n                />\n\n                <MapController\n                    selectedStage={selectedStage}\n                    stages={stages}\n                    userLocation={userLocation}\n                    mapRef={mapRef}\n                />\n\n                {stages.map((stage) => (\n                    <Marker\n                        key={stage.id}\n                        position={[stage.location.lat, stage.location.lng]}\n                        icon={createIcon(stage.isLive, stage.isFixed)}\n                        eventHandlers={{\n                            click: () => onSelectStage(stage.id === selectedStage ? null : stage.id),\n                        }}\n                    >\n                        <Popup className=\"dark-popup\">\n                            <div className=\"font-semibold\">{stage.name}</div>\n                            <div className=\"text-sm text-gray-400\">{stage.currentArtist}</div>\n                            <div className=\"text-xs text-gray-500 mt-1\">\n                                {stage.isFixed ? 'üìç Bloco fixo' : 'üö∂ Bloco m√≥vel'}\n                            </div>\n                        </Popup>\n                    </Marker>\n                ))}\n\n                <Marker position={[userLocation.lat, userLocation.lng]} icon={userIcon}>\n                    <Popup>Voc√™ est√° aqui</Popup>\n                </Marker>\n            </MapContainer>\n        )\n    }\n)\n\nLeafletMap.displayName = \"LeafletMap\""],"names":[],"mappings":"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"}}]
}